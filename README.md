# SoDRé Web System Documentation

**SoDRé（ソドレ）** のウェブサイトおよびコンテンツ管理システム（CMS）の技術仕様・操作マニュアルである。
本システムは、モダンなウェブ技術と **Supabase** を組み合わせ、サーバーレスかつ動的なコンテンツ管理を実現している。

---

## 📖 目次

1.  [システム概要](#1-システム概要)
2.  [ディレクトリ構造](#2-ディレクトリ構造)
3.  [管理画面操作マニュアル](#3-管理画面操作マニュアル)
    *   [3.1 ログイン](#31-ログイン)
    *   [3.2 ダッシュボード構成](#32-ダッシュボード構成)
    *   [3.3 記事投稿・編集](#33-記事投稿編集)
        *   [エディタ（ツールバー）の機能詳細](#エディタツールバーの機能詳細)
    *   [3.4 グループ管理](#34-グループ管理)
    *   [3.5 カレンダー管理](#35-カレンダー管理)
4.  [開発者向け情報](#4-開発者向け情報)
    *   [4.1 環境構築](#41-環境構築)
    *   [4.2 技術スタック](#42-技術スタック)

---

## 1. システム概要

本システムは、一般ユーザーが閲覧する **フロントエンド** と、管理者がコンテンツを操作する **管理画面（CMS）** の2層構造で構成される。

-   **一般公開ページ**: `index.html` をエントリポイントとし、Supabaseから取得したJSONデータをDOM操作により動的にレンダリングする。
-   **管理画面**: `admin.html` において、記事のCRUD（作成・読み取り・更新・削除）、グループ管理、カレンダー管理を行う。

---

## 2. ディレクトリ構造

主要な構成ファイルとその役割は以下の通りである。

```text
c:\dev\sodre\
│
├── index.html          # トップページ (NEWS, DIARY, TOPICSの最新記事表示)
├── admin.html          # 管理画面 (CMSへの入り口)
├── admin.js            # 管理画面ロジック (記事投稿・削除・編集、認証)
├── posts.js            # フロントエンド記事取得・表示ロジック
├── style.css           # 共通スタイルシート (CSS Variablesによるテーマ管理)
├── config.js           # Supabase接続設定 (API Keyなど)
│
├── members-area.html   # 会員限定エリア (グループ機能・掲示板UI)
├── calendar.js         # カレンダー描画ロジック
│
└── supabase/           # データベース定義 (SQL schema)
```

---

## 3. 管理画面操作マニュアル

管理画面 (`admin.html`) における各機能の操作方法を詳述する。

### 3.1 ログイン
1.  ブラウザより `/admin.html` へアクセスする。
2.  ログインフォームにて管理者権限を持つアカウントの **Email** および **Password** を入力する。
3.  「Login」ボタンを押下する。
    *   認証成功時：ダッシュボードへ遷移する。
    *   認証失敗または権限不足時：エラーメッセージが表示され、アクセスは拒否される。

### 3.2 ダッシュボード構成
ログイン後、左側サイドバーにより機能が区分されている。

*   **SoDRé CMS**: ダッシュボードトップ（現在はNEWSタブと同一）。
*   **ニュース / ダイアリー / トピックス**: 各カテゴリの記事管理。
*   **グループ管理**: 会員限定エリアのグループ作成およびメンバー権限設定。
*   **カレンダー管理**: スケジュールページに表示するイベントの管理。
*   **ユーザー管理**: 登録ユーザー情報の閲覧。

### 3.3 記事投稿・編集
「ニュース」「ダイアリー」「トピックス」各タブにおける共通の操作フローである。

#### 基本操作フロー
1.  **タイトル**: 記事の見出しを入力する。必須項目である。
2.  **画像**: 記事に添付する画像をアップロードする（複数選択可）。
    *   選択された画像は即座にプレビュー表示される。
    *   **仕様**: 画像が指定されなかった場合、システムは自動的に[代替画像](https://lh3.googleusercontent.com/a/ACg8ocKrevxxn-jyPFTJ3zy5r6EFRGmv0Tp8-qWyb3bMaXduuMzHS0Y=s400-c)を適用する。
3.  **本文**: リッチテキストエディタを用いて本文を作成する。
4.  **プレビュー**: 「プレビュー」ボタンを押下し、公開時のレイアウト（画像・装飾含む）を確認する。
5.  **公開**: 「記事を公開する」ボタンを押下し、データベースへ保存する。即時反映される。

#### エディタ（ツールバー）の機能詳細
本文入力エリア上部のツールバーアイコンの機能は以下の通りである。

| アイコン | 機能名 | 説明 |
| :--- | :--- | :--- |
| **B** | **太字 (Bold)** | 選択したテキストを太字にする。 |
| *I* | *斜体 (Italic)* | 選択したテキストを斜体にする。 |
| <u>U</u> | <u>下線 (Underline)</u> | 選択したテキストに下線を引く。 |
| ~~S~~ | ~~取り消し線 (Strike)~~ | 選択したテキストに取り消し線を引く。 |
| **“** | **引用 (Blockquote)** | 選択行を引用表示（インデント等）にする。 |
| **<>** | **コード (Code Block)** | ソースコード等の記述用ブロックを作成する。 |
| **H1** | **見出し1 (Header 1)** | 最上位の見出しとして書式設定する。 |
| **H2** | **見出し2 (Header 2)** | 2番目のレベルの見出しとして書式設定する。 |
| **1.** | **番号付きリスト** | 1, 2, 3... と続くリストを作成する。 |
| **•** | **箇条書きリスト** | 行頭に黒丸が付くリストを作成する。 |
| **A** | **文字色 (Color)** | テキストの色を変更する。プルダウンで色を選択。 |
| 🖌️ | **背景色 (Background)** | テキストの背景色（マーカー）を変更する。 |
| 🔗 | **リンク (Link)** | 選択テキストにURLリンクを設定する。 |
| **Tx** | **書式クリア (Clean)** | 選択範囲の全ての書式設定を解除する。 |

### 3.4 グループ管理
会員限定エリアのアクセス制御を行う機能である。

1.  **新規グループ作成**: グループ名・説明を入力し作成する。
2.  **メンバー追加・権限変更**:
    *   対象グループの「Manage Members」ボタンを押下し、詳細パネルを開く。
    *   **追加**: ユーザーのメールアドレスを入力し追加する。該当ユーザーが存在しない場合はエラーとなる。
    *   **権限**: 「Can Post / Read Only」トグルボタンにより、掲示板への書き込み権限を制御する。
        *   `Can Post` (緑): 投稿可能
        *   `Read Only` (ピンク): 閲覧のみ

### 3.5 カレンダー管理
スケジュールページ (`schedule.html`) のイベントデータソースを管理する。

1.  **予定タイプ（凡例）定義**:
    *   イベントの種類（例：「練習」「本番」）とその表示色（カラーピッカー）を定義する。
    *   ここで定義したタイプのみ、イベント登録時に選択可能となる。
2.  **イベント登録**:
    *   日付と予定タイプを選択し登録する。

---

## 4. 開発者向け情報

### 4.1 環境構築
1.  **デプロイ**: 静的ファイルホスティング環境へ全ファイルをアップロードする。
2.  **接続設定**: `config.js` を編集し、Supabaseプロジェクト情報を設定する。
    ```javascript
    window.SUPABASE_URL = "YOUR_SUPABASE_URL";
    window.SUPABASE_KEY = "YOUR_SUPABASE_ANON_KEY";
    ```
3.  **DBマイグレーション**: `supabase/` 以下のSQLを実行し、必要なテーブルおよびRLS（Row Level Security）ポリシーを適用する。

### 4.2 技術スタック
*   **Frontend**: HTML5, CSS3, JavaScript (ES2020+)
    *   **Library**: Quill.js (v1.3.6) - リッチテキストエディタ
*   **Backend**: Supabase
    *   **Auth**: メール認証 / ユーザー管理
    *   **Database**: PostgreSQL (JSONB等の活用は行わず、リレーショナルに正規化)
    *   **Storage**: 画像ファイル保存用バケット ('images')

---
© 2026 SoDRé & Junxiang Jin. All rights reserved.
